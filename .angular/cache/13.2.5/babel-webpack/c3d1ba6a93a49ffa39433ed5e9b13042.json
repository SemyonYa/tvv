{"ast":null,"code":"import { titleAnimation } from 'src/animations/title.animation';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"src/services/api/place.rest.service\";\nimport * as i2 from \"src/services/breadcrumbs.service\";\nimport * as i3 from \"@angular/router\";\nimport * as i4 from \"../../../shared/components/data/data.component\";\nimport * as i5 from \"@angular/common\";\nimport * as i6 from \"../../../shared/components/search-input/search-input.component\";\nimport * as i7 from \"../../../shared/components/grid/grid.component\";\nimport * as i8 from \"../../../shared/components/modal/modal.component\";\n\nfunction CabPlacesListComponent_div_5_i_grid_2_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r4 = i0.ɵɵgetCurrentView();\n\n    i0.ɵɵelementStart(0, \"i-grid\", 8);\n    i0.ɵɵlistener(\"onItemDoubleClick\", function CabPlacesListComponent_div_5_i_grid_2_Template_i_grid_onItemDoubleClick_0_listener($event) {\n      i0.ɵɵrestoreView(_r4);\n      const ctx_r3 = i0.ɵɵnextContext(2);\n      return ctx_r3.openItem($event);\n    })(\"onEditItem\", function CabPlacesListComponent_div_5_i_grid_2_Template_i_grid_onEditItem_0_listener($event) {\n      i0.ɵɵrestoreView(_r4);\n      const ctx_r5 = i0.ɵɵnextContext(2);\n      return ctx_r5.editCtor($event);\n    })(\"onDeleteItem\", function CabPlacesListComponent_div_5_i_grid_2_Template_i_grid_onDeleteItem_0_listener($event) {\n      i0.ɵɵrestoreView(_r4);\n      const ctx_r6 = i0.ɵɵnextContext(2);\n      return ctx_r6.onDelete($event);\n    });\n    i0.ɵɵelementEnd();\n  }\n\n  if (rf & 2) {\n    const ctx_r2 = i0.ɵɵnextContext(2);\n    i0.ɵɵproperty(\"items\", ctx_r2.filteredCtors)(\"titles\", ctx_r2.titles)(\"withEdit\", true)(\"withDelete\", true)(\"fields\", ctx_r2.fields);\n  }\n}\n\nfunction CabPlacesListComponent_div_5_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r8 = i0.ɵɵgetCurrentView();\n\n    i0.ɵɵelementStart(0, \"div\", 0)(1, \"i-search-input\", 6);\n    i0.ɵɵlistener(\"onChange\", function CabPlacesListComponent_div_5_Template_i_search_input_onChange_1_listener($event) {\n      i0.ɵɵrestoreView(_r8);\n      const ctx_r7 = i0.ɵɵnextContext();\n      return ctx_r7.search($event);\n    });\n    i0.ɵɵelementEnd();\n    i0.ɵɵtemplate(2, CabPlacesListComponent_div_5_i_grid_2_Template, 1, 5, \"i-grid\", 7);\n    i0.ɵɵelementEnd();\n  }\n\n  if (rf & 2) {\n    const ctx_r0 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(2);\n    i0.ɵɵproperty(\"ngIf\", ctx_r0.filteredCtors);\n  }\n}\n\nfunction CabPlacesListComponent_i_modal_6_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r10 = i0.ɵɵgetCurrentView();\n\n    i0.ɵɵelementStart(0, \"i-modal\", 9);\n    i0.ɵɵlistener(\"onCancel\", function CabPlacesListComponent_i_modal_6_Template_i_modal_onCancel_0_listener() {\n      i0.ɵɵrestoreView(_r10);\n      const ctx_r9 = i0.ɵɵnextContext();\n      return ctx_r9.closeCtor();\n    })(\"onOk\", function CabPlacesListComponent_i_modal_6_Template_i_modal_onOk_0_listener() {\n      i0.ɵɵrestoreView(_r10);\n      const ctx_r11 = i0.ɵɵnextContext();\n      return ctx_r11.deleteCtor();\n    });\n    i0.ɵɵelementStart(1, \"p\")(2, \"strong\");\n    i0.ɵɵtext(3);\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementStart(4, \"p\");\n    i0.ɵɵtext(5, \"\\u0423\\u0432\\u0435\\u0440\\u0435\\u043D?\");\n    i0.ɵɵelementEnd()();\n  }\n\n  if (rf & 2) {\n    const ctx_r1 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(3);\n    i0.ɵɵtextInterpolate1(\"\\u0423\\u0434\\u0430\\u043B\\u0435\\u043D\\u0438\\u0435 \\u043E\\u0431\\u044A\\u0435\\u043A\\u0442\\u0430 \", ctx_r1.ctorForDelete.name, \"\");\n  }\n}\n\nconst _c0 = function (a0) {\n  return [a0];\n};\n\nexport let CabPlacesListComponent = /*#__PURE__*/(() => {\n  class CabPlacesListComponent {\n    constructor(placeRest, breadcrumbsService, activatedRoute, router) {\n      this.placeRest = placeRest;\n      this.breadcrumbsService = breadcrumbsService;\n      this.activatedRoute = activatedRoute;\n      this.router = router;\n      this.titles = ['ID', 'Наименование', 'Регион'];\n      this.fields = ['id', 'name', 'region'];\n      this.searchValue = '';\n    }\n\n    ngOnInit() {\n      this.region = this.activatedRoute.snapshot.params.region;\n      this.breadcrumbsService.setItems([{\n        title: this.region,\n        route: ''\n      }]);\n      this.fetchData();\n    }\n\n    ngOnDestroy() {\n      this.subscription.unsubscribe();\n    }\n\n    fetchData() {\n      this.filteredCtors = null;\n      this.subscription = this.placeRest.getBy(this.region).subscribe(items => {\n        this.ctors = items;\n        this.filterCtors();\n      });\n    }\n\n    editCtor(id) {\n      this.router.navigateByUrl(`/cab/regions/${this.region}/edit/${id}`);\n    }\n\n    onDelete(id) {\n      this.ctorForDelete = this.ctors.find(c => c.id == id);\n    }\n\n    deleteCtor() {\n      this.placeRest.delete(this.ctorForDelete.id).subscribe(res => {\n        this.placeRest.getAll();\n        this.ctorForDelete = null;\n      }, this.placeRest.handleError);\n    }\n\n    closeCtor() {\n      this.ctorForDelete = null;\n    }\n\n    search(value) {\n      this.searchValue = value;\n      this.filterCtors();\n    }\n\n    filterCtors() {\n      this.filteredCtors = this.ctors ? this.ctors.filter(u => {\n        const searchFields = [u.name].join(' ').toLocaleLowerCase();\n        return this.searchValue ? searchFields.indexOf(this.searchValue.toLocaleLowerCase()) !== -1 : true;\n      }) : null;\n    }\n\n    openItem(placeId) {\n      console.log('Open place', placeId);\n      this.router.navigateByUrl(`/cab/places/${placeId}`);\n    }\n\n  }\n\n  CabPlacesListComponent.ɵfac = function CabPlacesListComponent_Factory(t) {\n    return new (t || CabPlacesListComponent)(i0.ɵɵdirectiveInject(i1.PlaceRestService), i0.ɵɵdirectiveInject(i2.BreadcrumbsService), i0.ɵɵdirectiveInject(i3.ActivatedRoute), i0.ɵɵdirectiveInject(i3.Router));\n  };\n\n  CabPlacesListComponent.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n    type: CabPlacesListComponent,\n    selectors: [[\"tvv-cab-places-list\"]],\n    decls: 7,\n    vars: 7,\n    consts: [[1, \"col\"], [\"type\", \"button\", 1, \"add\", \"success\", 3, \"routerLink\"], [\"src\", \"/assets/icons/plus-white.svg\", \"alt\", \"ADD\"], [3, \"list\"], [\"class\", \"col\", 4, \"ngIf\"], [3, \"onCancel\", \"onOk\", 4, \"ngIf\"], [3, \"onChange\"], [3, \"items\", \"titles\", \"withEdit\", \"withDelete\", \"fields\", \"onItemDoubleClick\", \"onEditItem\", \"onDeleteItem\", 4, \"ngIf\"], [3, \"items\", \"titles\", \"withEdit\", \"withDelete\", \"fields\", \"onItemDoubleClick\", \"onEditItem\", \"onDeleteItem\"], [3, \"onCancel\", \"onOk\"]],\n    template: function CabPlacesListComponent_Template(rf, ctx) {\n      if (rf & 1) {\n        i0.ɵɵelementStart(0, \"div\", 0)(1, \"button\", 1);\n        i0.ɵɵelement(2, \"img\", 2);\n        i0.ɵɵtext(3, \" \\u0414\\u043E\\u0431\\u0430\\u0432\\u0438\\u0442\\u044C \\u043D\\u0430\\u0441\\u0435\\u043B\\u0435\\u043D\\u043D\\u044B\\u0439 \\u043F\\u0443\\u043D\\u043A\\u0442 \");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(4, \"i-data\", 3);\n        i0.ɵɵtemplate(5, CabPlacesListComponent_div_5_Template, 3, 1, \"div\", 4);\n        i0.ɵɵelementEnd()();\n        i0.ɵɵtemplate(6, CabPlacesListComponent_i_modal_6_Template, 6, 1, \"i-modal\", 5);\n      }\n\n      if (rf & 2) {\n        i0.ɵɵproperty(\"@titleAnimation\", undefined);\n        i0.ɵɵadvance(1);\n        i0.ɵɵproperty(\"routerLink\", i0.ɵɵpureFunction1(5, _c0, \"/cab/regions/\" + ctx.region + \"/add\"));\n        i0.ɵɵadvance(3);\n        i0.ɵɵproperty(\"list\", ctx.ctors);\n        i0.ɵɵadvance(1);\n        i0.ɵɵproperty(\"ngIf\", ctx.ctors);\n        i0.ɵɵadvance(1);\n        i0.ɵɵproperty(\"ngIf\", ctx.ctorForDelete);\n      }\n    },\n    directives: [i3.RouterLink, i4.DataComponent, i5.NgIf, i6.SearchInputComponent, i7.GridComponent, i8.ModalComponent],\n    styles: [\"button.add[_ngcontent-%COMP%]{align-self:flex-start}\"],\n    data: {\n      animation: [titleAnimation]\n    }\n  });\n  return CabPlacesListComponent;\n})();","map":null,"metadata":{},"sourceType":"module"}